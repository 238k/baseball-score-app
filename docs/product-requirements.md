# プロダクト要求定義書 (Product Requirements Document)

## プロダクト概要

### 名称
**野球スコアブック** - プロ野球・草野球対応 スコア記録Webアプリ

### プロダクトコンセプト
- **NPB準拠スコアブック**: 日本式スコアブックのレイアウトをそのままデジタル化し、紙と同じ感覚で記録できる
- **一球入魂の記録**: 球種・コース単位のピッチトラッキングから打席結果・走者進塁まで、試合の全情報を正確に記録できる
- **タブレット最適化UI**: iPad等のタブレットをメインターゲットとし、球場での快適な片手・タッチ操作を実現する

### プロダクトビジョン
野球ファンや草野球の記録係が、紙のスコアブックと同じ直感的な操作で試合を記録できるWebアプリを提供する。
NPB準拠の標準フォーマットに沿いながら、自動集計・Undo・PWAオフライン対応により、紙では実現できない利便性を付加する。
記録したデータは認証付きクラウドに保存され、過去の試合をいつでも振り返れる「デジタルスコアブック」を実現する。

### 目的
- タブレットでの直感的な球場記録体験を提供し、紙スコアブックからの移行を促進する
- NPBスコアブック記号に準拠することで、従来の記録者が学習コストなく使い始められる
- 打者・投手の成績をリアルタイム自動計算し、試合中の分析を支援する
- PWAオフライン対応により、球場内の不安定なネットワーク環境でも途切れずに記録を続けられる

---

## ターゲットユーザー

### プライマリーペルソナ: 佐藤健司（38歳、会社員・プロ野球熱狂ファン）
- 年間20〜30試合を球場観戦し、紙のスコアブックで記録している
- スマートフォンよりiPadを好んで使用。球場では膝の上にiPadを置いて記録
- 現在の課題: 紙スコアブックでは打率・打点の手計算ミスが多く、試合後の集計に1時間かかる
- 期待する解決策: 入力と同時に成績が自動計算され、試合終了後すぐに成績表を確認したい
- 1日のワークフロー: 試合前にオーダーを入力 → 試合中にリアルタイム記録 → 試合後に成績を確認・印刷

### セカンダリーペルソナ: 山田誠（45歳、草野球チームのスコアラー）
- 月2〜3回の草野球試合で記録係を担当
- 選手名・背番号の手入力に慣れており、毎回一から入力することに抵抗なし
- 現在の課題: 紙スコアブックを自宅でスキャンして保管しているが、検索・比較ができない
- 期待する解決策: 過去の試合データをクラウドに保存し、いつでも見返せる

---

## 成功指標（KPI）

### プライマリーKPI
- **試合記録完了率**: 1試合を最後まで記録した割合が60%以上（リリース後3ヶ月以内）
- **スコア入力速度**: 1打席の入力（打席結果まで）を平均30秒以内で完了できる（ユーザビリティテスト）
- **オフライン動作率**: PWA環境下でネットワーク切断時も入力操作が継続できる（100%）

### セカンダリーKPI
- **印刷品質**: 印刷プレビューがA4/B5に適切に収まり、スコアが読み取れる（テストチェック）
- **データ保存信頼性**: 入力データのロスト件数がゼロ（オフライン→オンライン同期含む）
- **Undo対応**: 直前の入力を100%取り消せる（全操作でUndoが機能する）

---

## 機能要件

### コア機能（MVP）

#### 1. 試合設定

**ユーザーストーリー**:
スコアラーとして、試合記録を開始するために、チーム名・選手名・打順・守備位置を入力してオーダー表を作成したい

**受け入れ条件**:
- [ ] ホーム・ビジターのチーム名を入力できる
- [ ] 各チーム最大20名（先発9名＋控え）の選手名と守備位置（1〜9・指名打者）を打順に入力できる
- [ ] 先発・控えを区別して登録でき、交代時に新しい選手を同打順に追加できる
- [ ] イニング数の上限なし（延長対応）
- [ ] 打者一巡（同一打順の複数サイクル）に対応する

**優先度**: P0（必須）

---

#### 2. スコア入力（一球記録・打席結果）

**ユーザーストーリー**:
スコアラーとして、試合の全情報を正確に残すために、一球ごとの球種と打席結果をNPBスコアブック準拠の記号で入力したい

**受け入れ条件**:
- [ ] 一球ごとに以下を記録できる: ボール(B)、空振りストライク(S)、見逃しストライク(S)、ファウル(F)、インプレー、死球(HBP)
- [ ] 打席結果を以下のカテゴリから入力できる:
  - 安打: 単打・二塁打・三塁打・本塁打
  - アウト: ゴロ・フライ・ライナー・三振（空振り/見逃し）・犠打・犠飛
  - 出塁: 四球・死球
  - その他: 野選・エラー・併殺打・振り逃げ
- [ ] 打球方向を守備番号（1〜9）で入力できる
- [ ] エラーを記録し、関与した守備番号を指定できる
- [ ] 直前の入力を取り消すUndoが1操作以上連続で機能する

**優先度**: P0（必須）

---

#### 3. 走者進塁・アウト記録

**ユーザーストーリー**:
スコアラーとして、得点・打点を正しく計算するために、塁上の走者の進塁・アウトイベントを詳細に記録したい

**受け入れ条件**:
- [ ] 各打席中・打席後に走者ごとの進塁先を入力できる
- [ ] 以下のイベントを記録できる: 進塁・盗塁・盗塁死・暴投・パスボール・ボーク・牽制アウト
- [ ] 進塁時の得点・打点が自動計算される
- [ ] スコアブックセル内のダイヤモンド上に走塁経路が視覚的に表示される

**優先度**: P0（必須）

---

#### 4. 選手交代記録

**ユーザーストーリー**:
スコアラーとして、成績を正確に帰属させるために、代打・代走・守備交代・投手交代を記録したい

**受け入れ条件**:
- [ ] 代打・代走・守備交代・投手交代の4種類の交代を記録できる
- [ ] 交代後の選手が同打順に追加され、以降の打席はその選手に帰属する
- [ ] 投手交代時に投球回・成績が正確に分離される

**優先度**: P0（必須）

---

#### 5. スコアブックUI（NPB準拠レイアウト）

**ユーザーストーリー**:
スコアラーとして、紙のスコアブックと同じ感覚で記録するために、NPB標準フォーマットのスコアシートが表示されたい

**受け入れ条件**:
- [ ] 打席セルの中央に菱形（ダイヤモンド）を描画し、走者の走路を表示する
- [ ] 現在打席中の打者をハイライト表示する
- [ ] 塁上の走者状況（一・二・三塁）をリアルタイムで表示する
- [ ] タブレット（iPad 10インチ相当）での快適なタッチ操作が可能な大きさにセルを設計する
- [ ] 横スクロールでイニングを追える

**優先度**: P0（必須）

---

#### 6. リアルタイム成績集計（打者・投手）

**ユーザーストーリー**:
スコアラーとして、試合中の状況を分析するために、打者・投手の成績がリアルタイムで確認したい

**受け入れ条件**:
- [ ] 打者成績を自動計算: 打数・安打・打率・二塁打・三塁打・本塁打・打点・得点・四球・死球・三振・出塁率・長打率・OPS・犠打・犠飛・盗塁・盗塁死・併殺打・平均投球数/打席
- [ ] 投手成績を自動計算: 投球回・投球数・奪三振・与四球・与死球・被安打・被打率・失点・自責点・ERA・WHIP・K/9・BB/9・K/BB
- [ ] 成績は打席結果の入力と同時に即座に更新される（1秒以内）

**優先度**: P0（必須）

---

#### 7. データ保存・試合一覧（Supabase連携）

**ユーザーストーリー**:
スコアラーとして、過去の試合を振り返るために、試合データをクラウドに保存して一覧から呼び出したい

**受け入れ条件**:
- [ ] Supabase Authで認証し、自分のデータのみ閲覧・編集できる（RLS適用）
- [ ] 試合一覧を日付・チーム名で表示できる
- [ ] 記録中・完了済みのステータスを管理できる
- [ ] 試合データをリアルタイムでSupabaseに保存する（オフライン時はローカルに一時保存）

**優先度**: P0（必須）

---

#### 8. PWAオフライン対応

**ユーザーストーリー**:
スコアラーとして、球場の不安定なネットワーク環境でも記録を続けるために、オフラインでも全機能を使いたい

**受け入れ条件**:
- [ ] ネットワーク切断時もスコア入力・閲覧が継続できる
- [ ] オフライン中のデータはローカルに保存される
- [ ] オンライン復帰時に自動的にSupabaseへ同期される
- [ ] Serwistを使用してService Workerを実装する

**優先度**: P0（必須）

---

#### 9. 印刷機能

**ユーザーストーリー**:
スコアラーとして、記録結果を紙でも残すために、スコアブックレイアウトのまま印刷したい

**受け入れ条件**:
- [ ] `/games/[id]/print` の専用印刷ビューを提供する
- [ ] ブラウザの印刷機能でA4/B5に適切にレイアウトされる
- [ ] 印刷時にUI要素（ボタン等）が除去され、スコアシートのみが印刷される

**優先度**: P1（重要）

---

### 将来的な機能（Post-MVP）

#### 複数人リアルタイム同期
複数デバイスからの同時記録に対応する。

**優先度**: P2（できれば）

#### 選手・チームの事前登録・再利用
よく使うチーム・選手情報を登録し、試合設定時に呼び出せる。

**優先度**: P2（できれば）

#### 試合データエクスポート（CSV / PDF）
記録したデータをCSVやPDFで書き出せる。

**優先度**: P2（できれば）

#### 高度な指標対応
BABIP・wOBA・守備率などの高度な指標を計算する。

**優先度**: P2（できれば）

---

## 画面構成

| パス | 説明 |
|---|---|
| `/` | ホーム（試合一覧） |
| `/games/new` | 試合設定（チーム名・オーダー入力） |
| `/games/[id]` | スコア入力（メイン画面） |
| `/games/[id]/stats` | 成績集計 |
| `/games/[id]/print` | 印刷用ビュー |

---

## 非機能要件

### パフォーマンス
- スコア入力後の画面更新: 200ms以内
- 成績再計算: 入力確定後1秒以内
- 初回ロード（キャッシュ済みPWA）: 2秒以内

### ユーザビリティ
- タブレット（iPad 10インチ相当）での全操作がタッチのみで完結する
- 初めて使うユーザーがヘルプなしで試合設定〜最初の打席入力を10分以内に完了できる
- スコアブックの記号・用語はNPBスコアブック準拠とし、既存の記録者が追加学習なしに使用できる

### 信頼性
- オフライン中の入力データはローカルストレージに保存され、アプリ再起動後も失われない
- 同期エラー発生時はユーザーにリトライを促し、データをロストしない
- UndoはアプリリロードやSupabase同期前の全操作をカバーする

### セキュリティ
- Supabase Row Level Security (RLS) により、認証ユーザーは自分の試合データのみにアクセスできる
- 認証はSupabase Authを使用し、メール/パスワードまたはOAuth（Google等）に対応する
- APIキー等の秘匿情報は環境変数で管理し、クライアントには公開しない

### スケーラビリティ
- 1ユーザーが100試合以上記録しても一覧表示・検索が3秒以内に完了する
- 延長戦（25回以上）のデータも正常に記録・表示できる

---

## スコープ外

明示的にスコープ外とする項目:
- 複数人による同時記録・リアルタイム同期（Post-MVP）
- チーム・選手のマスターデータ登録・再利用（Post-MVP）
- 試合データのCSV/PDFエクスポート（Post-MVP）
- BABIP・wOBAなどの高度なセイバーメトリクス指標（Post-MVP）
- 守備統計（守備率等）（Post-MVP）
- 動画・写真との連携
- 他サービスとのAPI連携
