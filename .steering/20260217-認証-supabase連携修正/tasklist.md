# タスクリスト

## 🚨 タスク完全完了の原則

**このファイルの全タスクが完了するまで作業を継続すること**

---

## フェーズ1: 調査

- [x] 認証画面と Supabase 初期化コードを確認し、失敗要因を特定
- [x] 環境変数名の不一致（`PUBLISHABLE_KEY` / `ANON_KEY`）を確認

## フェーズ2: 実装修正

- [x] `lib/supabase/env.ts` を追加し、環境変数解決を共通化
- [x] `lib/supabase/client.ts` / `lib/supabase/server.ts` / `middleware.ts` を共通化された env 利用に更新
- [x] `app/(auth)/login/page.tsx` / `app/(auth)/signup/page.tsx` に初期化失敗ハンドリングを追加
- [x] `.env.local.example` と `docs/architecture.md` の環境変数記載を整合

## フェーズ3: 品質チェック

- [x] `npm run type-check` を実行し成功を確認
- [x] `npm run lint` を実行し成功を確認

---

## 実装後の振り返り

### 実装完了日
2026-02-17

### 計画と実績の差分
- 画面メッセージの文言を新規追加し、環境変数未設定時の失敗理由をユーザーに伝わる形にした。
- 認証処理のロジック自体（メール/パスワードの API 呼び出し）は変更せず、初期化レイヤーの互換性と例外処理に絞って修正した。

### 学んだこと
- Supabase のキー命名は環境ごとの差分が起きやすいため、共通ヘルパーで吸収する方が運用上安全。
- `createClient` 失敗時の例外ハンドリングがないと、ユーザーには「何もできない画面」に見えるため、UI レベルでのフォールバックが必須。
