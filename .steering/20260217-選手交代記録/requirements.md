# 要求内容

## 概要

スコア入力画面から代打・代走・守備交代・投手交代の4種類の選手交代を記録できる機能を実装する。
PRDの「機能4: 選手交代記録」に対応する。

## 背景

現在の実装では試合設定時の先発オーダーのみが登録され、試合中の選手交代を記録する手段がない。
代打・代走・投手交代は野球の試合で必ず発生するため、正確なスコア記録には不可欠な機能。

## 実装対象の機能

### 1. 選手交代入力パネル
- スコア入力画面に「交代」ボタンを追加
- タップで交代入力パネル（モーダル）が表示される
- パネルで以下を入力できる:
  - 交代種別: 代打 / 代走 / 守備交代 / 投手交代
  - 交代する打順 (1〜9) と現在の選手名を表示
  - 新しい選手名の入力
  - 新しい守備位置の選択

### 2. 交代処理ロジック
- **代打・代走・投手交代**: 同打順に `cycle+1` で新しい Lineup を追加
- **守備交代**: 既存 Lineup の `position` を更新（新しいエントリは作らない）
- 交代後の選手が以降の打席で使われるよう、gameStore が最新 cycle の選手を返す

## 受け入れ条件

### 選手交代入力パネル
- [ ] スコア入力画面に「交代」ボタンが表示される（pitching フェーズ時に活性）
- [ ] 交代種別（代打・代走・守備交代・投手交代）を選択できる
- [ ] 交代する打順（1〜9）を選択でき、現在の選手名が表示される
- [ ] 新しい選手名を入力できる
- [ ] 新しい守備位置を選択できる
- [ ] 「確定」で交代が gameStore に反映される
- [ ] 「キャンセル」でパネルが閉じ、何も変更されない

### 交代処理ロジック
- [ ] 代打・代走・投手交代で、同打順の cycle が +1 されたエントリが追加される
- [ ] 守備交代で、既存エントリの position が更新される（新エントリは追加されない）
- [ ] 交代後、スコア入力画面で新しい選手名が表示される
- [ ] 同打順に複数回交代した場合、最も大きい cycle の選手が現在の打者として使われる

## 成功指標

- 交代登録から次打者表示まで操作が直感的に完了できる
- 既存の scoreStore/gameStore のパターンと一貫した実装

## スコープ外

以下はこのフェーズでは実装しません:
- Supabase への交代データの永続化（現状はメモリのみ）
- Undo による交代の取り消し
- 交代履歴の表示画面
- 打席成績の選手別帰属計算

## 参照ドキュメント

- `docs/product-requirements.md` - 機能4: 選手交代記録
- `docs/functional-design.md` - ユースケース3: 選手交代（代打）
- `docs/architecture.md` - アーキテクチャパターン
